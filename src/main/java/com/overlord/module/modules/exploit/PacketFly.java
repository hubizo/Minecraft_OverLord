package com.overlord.module.modules.exploit;

import com.overlord.module.Category;
import com.overlord.module.Module;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.util.math.Vec3d;

public class PacketFly extends Module {
    private double speed = 0.5;
    
    public PacketFly() {
        super("PacketFly", "Fly using packets", Category.EXPLOIT);
    }
    
    @Override
    public void onTick() {
        if (mc.player == null) return;
        
        mc.player.setVelocity(Vec3d.ZERO);
        mc.player.noClip = true;
        
        double x = mc.player.getX();
        double y = mc.player.getY();
        double z = mc.player.getZ();
        
        Vec3d forward = Vec3d.fromPolar(0, mc.player.getYaw());
        
        if (mc.options.forwardKey.isPressed()) {
            x += forward.x * speed;
            z += forward.z * speed;
        }
        if (mc.options.backKey.isPressed()) {
            x -= forward.x * speed;
            z -= forward.z * speed;
        }
        if (mc.options.jumpKey.isPressed()) {
            y += speed;
        }
        if (mc.options.sneakKey.isPressed()) {
            y -= speed;
        }
        
        mc.player.setPos(x, y, z);
        mc.player.networkHandler.sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(x, y, z, false));
        mc.player.networkHandler.sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(x, y - 0.04, z, true));
    }
    
    @Override
    public void onDisable() {
        if (mc.player != null) {
            mc.player.noClip = false;
        }
    }
}
